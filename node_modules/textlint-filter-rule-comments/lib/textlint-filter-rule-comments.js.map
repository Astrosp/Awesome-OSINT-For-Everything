{"version":3,"file":"textlint-filter-rule-comments.js","names":["_StatusManager","_interopRequireDefault","require","_parseComment","obj","__esModule","_typeof","o","Symbol","iterator","constructor","prototype","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","t","i","_toPrimitive","String","r","e","toPrimitive","call","TypeError","Number","defaultOptions","module","exports","context","options","arguments","length","undefined","Syntax","shouldIgnore","getSource","enablingComment","disablingComment","content","statusManager","StatusManager","Html","node","nodeValue","isHTMLComment","comments","getValuesFromHTMLComment","forEach","commentValue","indexOf","configValue","removeCommentDescription","replace","enableReporting","parseRuleIds","disableReporting","Comment","concat","Document","exit","ignoringMessages","getIgnoringMessages","message","range","startIndex","endIndex","ruleId"],"sources":["../src/textlint-filter-rule-comments.js"],"sourcesContent":["// LICENSE : MIT\n\"use strict\";\nimport StatusManager from \"./StatusManager\";\nimport {parseRuleIds, getValuesFromHTMLComment, isHTMLComment, removeCommentDescription} from \"./parse-comment\";\nconst defaultOptions = {\n    // enable comment directive\n    // if comment has the value, then enable textlint rule\n    \"enablingComment\": \"textlint-enable\",\n    // disable comment directive\n    // if comment has the value, then disable textlint rule\n    \"disablingComment\": \"textlint-disable\"\n};\nmodule.exports = function(context, options = defaultOptions) {\n    const {Syntax, shouldIgnore, getSource} = context;\n\n    const enablingComment = options.enablingComment || defaultOptions.enablingComment;\n    const disablingComment = options.disablingComment || defaultOptions.disablingComment;\n\n    const content = getSource();\n    const statusManager = new StatusManager(content.length);\n    // Get comment value\n    return {\n        /*\n\nThis is wrong format.\nhttps://github.com/wooorm/remark treat as one html block.\n\n<!-- textlint-disable -->\nThis is ignored.\n<!-- textlint-enable -->\n\nshould be\n\n<!-- textlint-disable -->\n\nThis is ignored.\n\n<!-- textlint-enable -->\n         */\n        [Syntax.Html](node){\n            const nodeValue = getSource(node);\n            if (!isHTMLComment(nodeValue)) {\n                return;\n            }\n            const comments = getValuesFromHTMLComment(nodeValue);\n            comments.forEach(commentValue => {\n                if (commentValue.indexOf(enablingComment) !== -1) {\n                    const configValue = removeCommentDescription(commentValue.replace(enablingComment, \"\"));\n                    statusManager.enableReporting(node, parseRuleIds(configValue));\n                } else if (commentValue.indexOf(disablingComment) !== -1) {\n                    const configValue = removeCommentDescription(commentValue.replace(disablingComment, \"\"));\n                    statusManager.disableReporting(node, parseRuleIds(configValue));\n                }\n            });\n        },\n        [Syntax.Comment](node){\n            const commentValue = node.value || \"\";\n            if (commentValue.indexOf(enablingComment) !== -1) {\n                const configValue = removeCommentDescription(commentValue.replace(enablingComment, \"\"));\n                statusManager.enableReporting(node, parseRuleIds(configValue));\n            } else if (commentValue.indexOf(disablingComment) !== -1) {\n                const configValue = removeCommentDescription(commentValue.replace(disablingComment, \"\"));\n                statusManager.disableReporting(node, parseRuleIds(configValue));\n            }\n        },\n        [`${Syntax.Document}:exit`](){\n            const ignoringMessages = statusManager.getIgnoringMessages();\n            ignoringMessages.forEach(message => {\n                const range = [message.startIndex, message.endIndex];\n                shouldIgnore(range, {\n                    ruleId: message.ruleId || \"*\"\n                });\n            })\n        }\n    }\n};\n"],"mappings":"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","ignoreList":[]}